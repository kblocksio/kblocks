apiVersion: kblocks.io/v1
kind: Block
metadata:
  name: kblock
  namespace: kblocks
spec:
  engine: cdk8s
  definition:
    group: kblocks.io
    version: v1
    kind: Block
    plural: blocks
    readme: README.md
    icon: heroicon://cube
    schema:
      type: object
      properties:
        spec:
          type: object
          properties:
            engine:
              type: string
              enum:
                - tofu
                - helm
                - wing
                - wing/tf-aws
                - wing/k8s
                - cdk8s
                - noop
            source:
              type: object
              properties:
                url:
                  type: string
                branch:
                  type: string
                directory:
                  type: string
              required:
                - url
                - branch
                - directory
            definition:
              type: object
              properties:
                group:
                  type: string
                version:
                  type: string
                kind:
                  type: string
                plural:
                  type: string
                singular:
                  type: string
                shortNames:
                  type: array
                  items:
                    type: string
                categories:
                  type: array
                  items:
                    type: string
                listKind:
                  type: string
                outputs:
                  type: array
                  items:
                    type: string
                schema:
                  x-kubernetes-preserve-unknown-fields: true
                readme:
                  type: string
                description:
                  type: string
                icon:
                  type: string
                color:
                  type: string
              required:
                - group
                - version
                - kind
                - plural
            operator:
              type: object
              properties:
                namespace:
                  type: string
                permissions:
                  type: array
                  items:
                    type: object
                    properties:
                      apiGroups:
                        type: array
                        items:
                          type: string
                      resources:
                        type: array
                        items:
                          type: string
                      verbs:
                        type: array
                        items:
                          type: string
                    required:
                      - apiGroups
                      - resources
                      - verbs
                envSecrets:
                  type: object
                  additionalProperties:
                    type: string
                envConfigMaps:
                  type: object
                  additionalProperties:
                    type: string
                env:
                  type: object
                  additionalProperties:
                    type: string
                workers:
                  type: number
                  default: 1
              required:
                - namespace
          required:
            - engine
            - definition
            - operator
      required:
        - spec
  operator:
    namespace: kblocks
    env:
      KBLOCKS_EVENTS_URL: https://api.kblocks.io/api/events
      KBLOCKS_CONTROL_URL: wss://api.kblocks.io/api/control
      KBLOCKS_SYSTEM_ID: demo
